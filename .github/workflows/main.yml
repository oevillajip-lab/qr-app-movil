name: QR+Logo
on: [push]

jobs:
  build:
    runs-on: ubuntu-latest

    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-java@v4
        with:
          distribution: zulu
          java-version: '17'

      - uses: subosito/flutter-action@v2
        with:
          flutter-version: '3.13.0'
          channel: stable

      - name: Build QR+Logo
        run: |
          # Genera la estructura faltante (android/, etc.)
          # El nombre t√©cnico NO puede llevar + ni espacios
          flutter create --project-name qr_logo .

          # Fuerza SDK 34
          sed -i 's/flutter.compileSdkVersion/34/g' android/app/build.gradle
          sed -i 's/flutter.targetSdkVersion/34/g' android/app/build.gradle

          # Nombre visible de la app instalada en Android
          sed -i 's/android:label="qr_logo"/android:label="QR+Logo"/g' android/app/src/main/AndroidManifest.xml

          flutter pub get
          flutter pub run flutter_launcher_icons
          flutter build apk --release

          # Renombra el APK final
          mv build/app/outputs/flutter-apk/app-release.apk build/app/outputs/flutter-apk/QR+Logo.apk

      - name: Upload QR+Logo APK
        uses: actions/upload-artifact@v4
        with:
          name: QR+Logo
          path: build/app/outputs/flutter-apk/QR+Logo.apk
